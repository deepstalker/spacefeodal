class H{scene;textureKey;depth;parallax=1;alpha=1;blendMode=Phaser.BlendModes.NORMAL;worldW=0;worldH=0;tileW=1024;tileH=1024;overdrawTiles=3;pool=[];activeKeys=new Set;rotationByKey=new Map;constructor(l,e,o=-20,i=1,h=1,d=Phaser.BlendModes.NORMAL){this.scene=l,this.textureKey=e,this.depth=o,this.parallax=i,this.alpha=h,this.blendMode=d}init(l,e){this.worldW=l,this.worldH=e;const i=this.scene.textures.get(this.textureKey).getSourceImage();i&&i.width&&i.height&&(this.tileW=i.width,this.tileH=i.height)}update(){const e=this.scene.cameras.main.worldView,o=e.x*this.parallax,i=e.y*this.parallax,h=e.width*this.parallax,d=e.height*this.parallax,n=this.overdrawTiles,p=Math.floor(o/this.tileW)-n,f=Math.floor((o+h-1)/this.tileW)+n,x=Math.floor(i/this.tileH)-n,g=Math.floor((i+d-1)/this.tileH)+n,c=new Set;for(let s=x;s<=g;s++)for(let t=p;t<=f;t++)c.add(`${t}:${s}`);for(let s=0;s<this.pool.length;s++){const t=this.pool[s],r=t.__tileKey;r&&!c.has(r)&&(t.setVisible(!1),t.__tileKey=void 0)}c.forEach(s=>{let t=this.pool.find(a=>a.__tileKey===s);t||(t=this.pool.find(a=>!a.__tileKey),t||(t=this.scene.add.image(0,0,this.textureKey).setOrigin(0,0).setDepth(this.depth),t.setScrollFactor(1),t.setAlpha(this.alpha),t.setBlendMode(this.blendMode),this.pool.push(t)),t.__tileKey=s);const[r,y]=s.split(":").map(a=>parseInt(a,10)),M=(o%this.tileW+this.tileW)%this.tileW,u=(i%this.tileH+this.tileH)%this.tileH,w=r*this.tileW-M,K=y*this.tileH-u;t.setPosition(Math.round(w),Math.round(K)),t.setAngle(0),t.setVisible(!0)})}getAngleForKey(l){let e=this.rotationByKey.get(l);if(e==null){let o=0;for(let h=0;h<l.length;h++)o=o*31+l.charCodeAt(h)|0;e=Math.abs(o)%2*180,this.rotationByKey.set(l,e)}return e}}export{H as BackgroundTiler};
