class T{scene;config;stations=[];constructor(i,t){this.scene=i,this.config=t}init(){const i=this.config.system;if(i?.stations)for(const t of i.stations)t.type==="pirate_base"&&this.spawnPirateBase(t)}spawnPirateBase(i){const t=i.x,r=i.y,e=this.scene.add.rectangle(t,r,420,420,8330525).setDepth(.2),b=this.scene.add.text(t,r,"Пиратская база",{color:"#fca5a5",fontSize:"20px",fontStyle:"bold"}).setOrigin(.5).setDepth(.21);e.__hp=5e3,e.__alive=!0,this.stations.push({type:"pirate_base",obj:e,label:b});const f=this.scene.combat;if(f&&Array.isArray(f.targets)){const h=this.scene.add.rectangle(e.x-64,e.y-260,128,8,1120295).setOrigin(0,.5).setDepth(.15),l=this.scene.add.rectangle(e.x-64,e.y-260,128,8,15680580).setOrigin(0,.5).setDepth(.16);h.setVisible(!1),l.setVisible(!1),f.targets.push({obj:e,hp:5e3,hpMax:5e3,hpBarBg:h,hpBarFill:l,ai:{type:"static",preferRange:0,retreatHpPct:0},faction:"pirate"})}const v=1400,_=600;let g=0;this.scene.events.on(Phaser.Scenes.Events.UPDATE,(h,l)=>{const c=this.scene.pauseManager;if(c?.getPaused&&c.getPaused()||!e.__alive)return;const o=this.scene.combat,p=this.scene.time.now;let n=null,y=Number.POSITIVE_INFINITY;for(const a of o?.targets??[]){if(!a.obj?.active||a.faction==="pirate")continue;const s=Phaser.Math.Distance.Between(t,r,a.obj.x,a.obj.y);s<y&&s<=v&&(n=a.obj,y=s)}if(n&&p-g>_){g=p;const a=Math.atan2(n.y-r,n.x-t),s=this.scene.add.rectangle(t,r,12,4,16737894).setDepth(.25),m=900,x=Math.cos(a)*m,S=Math.sin(a)*m,d=(u,P)=>{if(c?.getPaused&&c.getPaused())return;s.x+=x*(P/1e3),s.y+=S*(P/1e3),Phaser.Math.Distance.Between(s.x,s.y,n.x,n.y)<30&&n.active&&(this.scene.combat?.applyDamage?.(n,20,e),this.scene.events.off(Phaser.Scenes.Events.UPDATE,d),s.destroy())};this.scene.events.on(Phaser.Scenes.Events.UPDATE,d);const E=this.scene.time.delayedCall(2e3,()=>{this.scene.events.off(Phaser.Scenes.Events.UPDATE,d),s.destroy()});if(c?.pauseTimer){const u=`station-projectile-lifetime-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;c.pauseTimer(E,u)}}});const D=(h,l)=>{const o=this.scene.combat?.targets?.find(p=>p.obj===e);o&&o.hp<=0&&e.__alive&&(e.__alive=!1,e.destroy(),b.destroy(),o.hpBarBg.destroy(),o.hpBarFill.destroy())};this.scene.events.on(Phaser.Scenes.Events.UPDATE,D)}}export{T as SpaceStationManager};
