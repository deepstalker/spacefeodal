class B{scene;config;stations=[];constructor(c,t){this.scene=c,this.config=t}init(){const c=this.config.system;if(c?.stations)for(const t of c.stations)t.type==="pirate_base"&&this.spawnPirateBase(t)}spawnPirateBase(c){const t=c.x,o=c.y,e=this.scene.add.rectangle(t,o,420,420,8330525).setDepth(.2),f=this.scene.add.text(t,o,"Пиратская база",{color:"#fca5a5",fontSize:"20px",fontStyle:"bold"}).setOrigin(.5).setDepth(.21);e.__hp=5e3,e.__alive=!0,this.stations.push({type:"pirate_base",obj:e,label:f});const l=this.scene.combat;if(l&&Array.isArray(l.targets)){const r=this.scene.add.rectangle(e.x-64,e.y-260,128,8,1120295).setOrigin(0,.5).setDepth(.15),h=this.scene.add.rectangle(e.x-64,e.y-260,128,8,15680580).setOrigin(0,.5).setDepth(.16);r.setVisible(!1),h.setVisible(!1),l.targets.push({obj:e,hp:5e3,hpMax:5e3,hpBarBg:r,hpBarFill:h,ai:{type:"static",preferRange:0,retreatHpPct:0},faction:"pirate"})}const _=1400,P=600;let d=0;this.scene.events.on(Phaser.Scenes.Events.UPDATE,(r,h)=>{if(!e.__alive)return;const y=this.scene.combat,i=this.scene.time.now;let s=null,b=Number.POSITIVE_INFINITY;for(const a of y?.targets??[]){if(!a.obj?.active||a.faction==="pirate")continue;const n=Phaser.Math.Distance.Between(t,o,a.obj.x,a.obj.y);n<b&&n<=_&&(s=a.obj,b=n)}if(s&&i-d>P){d=i;const a=Math.atan2(s.y-o,s.x-t),n=this.scene.add.rectangle(t,o,12,4,16737894).setDepth(.25),g=900,D=Math.cos(a)*g,x=Math.sin(a)*g,p=(E,v)=>{n.x+=D*(v/1e3),n.y+=x*(v/1e3),Phaser.Math.Distance.Between(n.x,n.y,s.x,s.y)<30&&s.active&&(this.scene.combat?.applyDamage?.(s,20,e),this.scene.events.off(Phaser.Scenes.Events.UPDATE,p),n.destroy())};this.scene.events.on(Phaser.Scenes.Events.UPDATE,p),this.scene.time.delayedCall(2e3,()=>{this.scene.events.off(Phaser.Scenes.Events.UPDATE,p),n.destroy()})}});const m=(r,h)=>{const i=this.scene.combat?.targets?.find(s=>s.obj===e);i&&i.hp<=0&&e.__alive&&(e.__alive=!1,e.destroy(),f.destroy(),i.hpBarBg.destroy(),i.hpBarFill.destroy())};this.scene.events.on(Phaser.Scenes.Events.UPDATE,m)}}export{B as SpaceStationManager};
