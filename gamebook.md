# Gamebook SF A2

## Текущая версия (Реализованные механики)

### Управление и исследование
- **ПКМ**: постановка цели перемещения с прямолинейным маршрутом
- **ЛКМ**: выбор целей для боя (враги подсвечиваются красным кругом)
- **Перетаскивание ЛКМ**: панорамирование камеры (drag-to-pan)
- **Колесо мыши**: масштабирование камеры с центрированием
- **F**: переключение режима слежения за кораблём
- **Кинематическое движение**: ускорение, торможение, поворот с учётом инерции
- **Автоматическая остановка**: корабль точно останавливается в целевой точке

### Боевая система
- **Автоматический огонь**: при выборе цели корабль автоматически ведёт огонь
- **Система оружия**: лазеры, пушки, ракеты с разными характеристиками
- **ИИ противников**: агрессивное поведение с поддержанием дистанции
- **Система здоровья**: HP бары, плавающий урон, визуальные эффекты попаданий
- **Баллистика**: упреждающая стрельба с учётом движения цели

### Звёздные системы
- **Множественные системы**: Sol, Beta, Paradise (статические) + процедурная генерация
- **Орбитальная механика**: планеты движутся по круговым орбитам вокруг звезды
- **Точки интереса (POI)**: энкаунтеры активируются при приближении
- **NPC торговцы**: автономные корабли с поведением "планетарный торговец"
- **Процедурная генерация**: системы создаются по профилям с настраиваемыми параметрами

### Визуальная система
- **Многослойный фон**: звёзды и туманности с эффектом параллакса
- **Миникарта**: отображает всю систему, корабль, планеты, POI и область видимости камеры
- **Эффекты**: вспышки при попаданиях, анимации появления/исчезновения
- **Адаптивный интерфейс**: масштабирование под разные разрешения экрана

## Детальная конфигурационная система

### settings.json - Основные настройки экрана и интерфейса

#### Разрешение и масштабирование
- `resolution.width/height` (пиксели): Целевое разрешение окна игры
  - **По умолчанию**: 1920×1080
  - **Влияние**: Определяет базовые пропорции интерфейса
- `scaleMode` (строка): Режим адаптации к размеру окна
  - **Значение**: "RESIZE" - подстраивается под реальный размер окна
  - **Влияние**: Игра масштабируется под любое разрешение экрана

#### Интерфейс
- `ui.theme` (строка): Цветовая схема интерфейса
  - **По умолчанию**: "dark"
  - **Влияние**: Определяет общий стиль UI элементов
- `ui.fontFamily` (строка): Семейство шрифтов
  - **По умолчанию**: "Inter, Arial, sans-serif"
  - **Влияние**: Читаемость текста в интерфейсе
- `ui.baseFontSize` (пиксели): Базовый размер шрифта
  - **По умолчанию**: 18
  - **Влияние**: Масштаб всех текстовых элементов
- `ui.spacing.xs/sm/md/lg/xl` (пиксели): Система отступов
  - **Значения**: 4/8/12/16/24
  - **Влияние**: Консистентность расположения элементов интерфейса

#### Камера
- `camera.minZoom/maxZoom` (коэффициент): Пределы масштабирования
  - **По умолчанию**: 0.3 - 2.5
  - **Влияние**: Насколько далеко/близко можно приблизить камеру
- `camera.edgePanMargin` (пиксели): Ширина зоны панорамирования у краёв
  - **По умолчанию**: 24
  - **Влияние**: Чувствительность панорамирования мышью
- `camera.edgePanSpeed` (пиксели/сек): Скорость панорамирования
  - **По умолчанию**: 600
  - **Влияние**: Быстрота перемещения камеры при edge-pan

### gameplay.json - Механика движения и геймплея

#### Система движения (безразмерные единицы на кадр)
- `movement.MAX_SPEED` (единиц/кадр): Максимальная скорость корабля
  - **По умолчанию**: 1.0
  - **Влияние**: Время перелётов между объектами, общий темп игры
- `movement.ACCELERATION` (единиц/кадр²): Ускорение при разгоне
  - **По умолчанию**: 0.025
  - **Влияние**: Отзывчивость управления, время достижения максимальной скорости
- `movement.DECELERATION` (единиц/кадр²): Торможение при остановке
  - **По умолчанию**: 0.08
  - **Влияние**: Точность остановки, тормозной путь
- `movement.TURN_SPEED` (радиан/кадр): Скорость поворота
  - **По умолчанию**: 0.02 (~1.15°/кадр)
  - **Влияние**: Манёвренность корабля, время разворота на 180°
- `movement.SLOWING_RADIUS` (игровые единицы): Радиус начала торможения
  - **По умолчанию**: 150
  - **Влияние**: Плавность подлёта к цели, точность остановки
- `movement.TURN_PENALTY_MULTIPLIER` (коэффициент): Штраф скорости при повороте
  - **По умолчанию**: 1.3
  - **Влияние**: Реалистичность поведения - корабль замедляется в поворотах
- `movement.TURN_DECELERATION_FACTOR` (коэффициент): Дополнительное торможение в повороте
  - **По умолчанию**: 0.2
  - **Влияние**: Насколько сильно корабль тормозит при манёврах

#### Игровая механика
- `dock_range` (игровые единицы): Дистанция стыковки с планетами
  - **По умолчанию**: 220
  - **Влияние**: С какого расстояния NPC начинают стыковку с планетами
- `fov.radiusUnits` (игровые единицы): Радиус обзора (зарезервировано)
  - **По умолчанию**: 1200
  - **Влияние**: Дальность видимости для будущей системы тумана войны

### ships.json - Конфигурация кораблей

#### Общая структура
- `current` (строка): ID корабля по умолчанию для игрока
- `defs.{shipId}`: Определения типов кораблей

#### Характеристики корабля
- `displayName` (строка): Отображаемое название корабля
- `hull` (единицы HP): Прочность корабля
  - **Explorer**: 3000 HP (исследовательский, прочный)
  - **Trader**: 600 HP (торговый, средний)
  - **Fighter**: 80 HP (боевой, хрупкий)
  - **Влияние**: Выживаемость в бою, время уничтожения

#### Визуальные параметры (sprite)
- `key` (строка): ID текстуры корабля
- `displaySize.width/height` (пиксели): Размер отображения
- `origin.x/y` (0.0-1.0): Точка привязки спрайта
- `noseOffsetDeg` (градусы): Поворот спрайта относительно направления движения
  - **Влияние**: Визуальное соответствие направления движения

#### Боевые характеристики (combat)
- `weaponSlots` (количество): Число слотов для оружия
- `accuracy` (0.0-1.0): Точность стрельбы
  - **Explorer**: 0.6 (средняя)
  - **Trader**: 0.5 (низкая)
  - **Fighter**: 0.8 (высокая)
  - **Влияние**: Эффективность упреждающей стрельбы
- `sensorRadius` (игровые единицы): Дальность обнаружения целей
- `slots[].offset.x/y` (пиксели): Позиции установки оружия относительно центра корабля

#### Индивидуальные параметры движения
Каждый тип корабля может переопределять параметры из gameplay.json:
- **Explorer**: Сбалансированные характеристики
- **Trader**: Медленный (MAX_SPEED: 0.5), но манёвренный (TURN_SPEED: 0.06)
- **Fighter**: Быстрый (MAX_SPEED: 1.2) и резкий (высокие ускорения)

### weapons.json - Система вооружения

#### Структура оружия
- `defs.{weaponId}`: Определения типов оружия

#### Параметры снарядов (projectile)
- `shape` (строка): Форма снаряда ("rect", "circle")
- `width/height` или `radius` (пиксели): Размеры для отображения
- `color` (hex): Цвет снаряда

#### Эффекты попадания (hitEffect)
- `shape/radius/color`: Визуальные параметры взрыва
- `durationMs` (миллисекунды): Длительность анимации взрыва

#### Боевые характеристики
- `projectileSpeed` (игровые единицы/сек): Скорость полёта снаряда
  - **Laser**: 700 (быстрые)
  - **Cannon**: 500 (средние)
  - **Missile**: 200 (медленные)
  - **Влияние**: Сложность уклонения, время полёта до цели
- `fireRatePerSec` (выстрелов/сек): Скорострельность
  - **Laser**: 4 (высокая)
  - **Cannon**: 2 (средняя)
  - **Missile**: 1 (низкая)
  - **Влияние**: DPS, расход боеприпасов
- `damage` (единицы урона): Урон за попадание
  - **Laser**: 8 (низкий)
  - **Cannon**: 16 (средний)
  - **Missile**: 26 (высокий)
  - **Влияние**: Эффективность против разных типов целей
- `range` (игровые единицы): Максимальная дальность
  - **Laser**: 300 (ближний бой)
  - **Cannon**: 500 (средняя дистанция)
  - **Missile**: 700 (дальний бой)
  - **Влияние**: Тактические возможности, безопасная дистанция боя
- `muzzleOffset.x/y` (пиксели): Смещение точки выстрела от центра корабля

### enemies.json & ai_profiles.json - ИИ и противники

#### Определения врагов (enemies.json)
- `defs.{enemyId}`: Конфигурации типов врагов
- `displayName` (строка): Название для интерфейса
- `shipId` (строка): Ссылка на тип корабля из ships.json
- `weapons` (массив строк): Список оружия врага
- `aiProfile` (строка): Ссылка на профиль поведения

#### Профили ИИ (ai_profiles.json)
- `profiles.{profileId}`: Определения поведения
- `behavior` (строка): Тип поведения
  - **"aggressive"**: Атакует игрока, поддерживает боевую дистанцию
  - **"static"**: Неподвижный, не атакует
  - **"planet_trader"**: Торгует между планетами
- `startDisposition` (строка): Начальное отношение
  - **"enemy"**: Враждебный
  - **"neutral"**: Нейтральный
  - **"ally"**: Союзный
- `combat.preferRange` (игровые единицы): Предпочитаемая дистанция боя
  - **Влияние**: ИИ старается держаться на этом расстоянии от цели
- `combat.retreatHpPct` (0.0-1.0): Порог отступления по здоровью
  - **Влияние**: При каком проценте HP ИИ начинает отступать

### systems.json & system_*.json - Звёздные системы

#### Индекс систем (systems.json)
- `current` (строка): ID текущей активной системы
- `defs.{systemId}`: Определения доступных систем
  - `name` (строка): Отображаемое название
  - `type` (строка): "static" или "procedural"
  - `configPath` (строка): Путь к конфигу для статических систем
  - `profile` (строка): Профиль для процедурных систем
  - `seed` (число): Зерно генерации для процедурных систем

#### Конфигурация системы (system_*.json)
- `size.width/height` (игровые единицы): Размеры системы
  - **По умолчанию**: 25000×25000
  - **Влияние**: Время на полное исследование, масштаб перелётов
- `star.x/y` (игровые единицы): Координаты центральной звезды
  - **Обычно**: Центр системы
  - **Влияние**: Точка отсчёта для орбит планет

#### Планеты
- `planets[].id/name` (строка): Идентификатор и название
- `planets[].orbit.radius` (игровые единицы): Радиус орбиты от звезды
  - **Диапазон**: 3000-12000
  - **Влияние**: Время перелёта от звезды, визуальное разнообразие
- `planets[].orbit.angularSpeedDegPerSec` (градусы/сек): Скорость вращения по орбите
  - **Диапазон**: 2.5-8.0
  - **Влияние**: Динамичность системы, сложность перехвата движущихся целей
- `planets[].color` (hex): Цвет планеты для отображения

#### Точки интереса (POI)
- `poi[].id/name` (строка): Идентификатор и название энкаунтера
- `poi[].x/y` (игровые единицы): Координаты относительно звезды
- `poi[].discovered` (boolean): Статус открытия (для сохранений)

#### NPC размещение
- `npcs[].prefab` (строка): Тип NPC из stardwellers.json
- `npcs[].x/y` (игровые единицы): Прямые координаты
- `npcs[].planetId` (строка): Размещение возле планеты

### system_profiles.json - Профили процедурной генерации

#### Параметры звезды
- `starRadius.min/max` (игровые единицы): Диапазон размеров звезды
  - **По умолчанию**: 600-3000
  - **Влияние**: Визуальный масштаб центрального объекта

#### Орбитальная структура
- `orbits.min/max` (количество): Диапазон числа орбит
  - **По умолчанию**: 2-16
  - **Влияние**: Плотность системы, количество планет
- `orbitGap.min/max` (игровые единицы): Расстояние между орбитами
  - **По умолчанию**: 1000-2000
  - **Влияние**: Компактность системы, время перелётов
- `planetSize.min/max` (игровые единицы): Диапазон размеров планет
  - **По умолчанию**: 200-500
  - **Влияние**: Визуальное разнообразие
- `satellitesPerPlanet.min/max` (количество): Спутники у планет
  - **По умолчанию**: 0-3
  - **Влияние**: Сложность навигации, визуальное богатство

#### Энкаунтеры
- `encounters.count.min/max` (количество): Число точек интереса
  - **По умолчанию**: 0-30
  - **Влияние**: Частота событий, плотность контента
- `encounters.radius.min/max` (игровые единицы): Дистанция размещения от звезды
  - **По умолчанию**: 500-4000
  - **Влияние**: Распределение событий по системе
- `encounters.minSpacing` (игровые единицы): Минимальное расстояние между энкаунтерами
  - **По умолчанию**: 500
  - **Влияние**: Предотвращает скучивание событий
- `encounters.types[].activation_range` (игровые единицы): Дистанция активации
  - **lost_treasure**: 300 (близко)
  - **pirates**: 600 (издалека)
  - **Влияние**: Время реакции игрока на событие

### player.json - Конфигурация игрока
- `shipId` (строка): ID корабля игрока из ships.json
  - **По умолчанию**: "explorer"
- `weapons` (массив строк): Стартовое оружие
  - **По умолчанию**: ["laser", "cannon", "missile"]
- `start.x/y` (игровые единицы или null): Стартовые координаты
  - **null**: Автоматическое размещение возле звезды
- `start.headingDeg` (градусы): Начальное направление корабля
- `start.zoom` (коэффициент): Начальный зум камеры

### stardwellers.json - NPC префабы
- `prefabs.{prefabId}`: Определения типов NPC
- `shipId` (строка): Тип корабля из ships.json
- `aiProfile` (строка): Профиль поведения из ai_profiles.json
- `weapons` (массив строк): Оружие NPC

### Служебные конфигурации

#### keybinds.json - Привязки клавиш
- `toggleFollow` (строка): Клавиша переключения слежения камеры
  - **По умолчанию**: "F"

#### modules.json - Переключатели модулей
- `navigation/combat/llm` (boolean): Включение/отключение модулей системы

#### persistence.json - Настройки сохранения
- `saveKey` (строка): Ключ для localStorage
  - **По умолчанию**: "sf_a2_save_v1"

#### assets.json - Конфигурация ресурсов
- `plugins.rexUI/spine` (boolean): Включение плагинов
- `procedural`: Настройки процедурной графики
- `sprites`: Параметры спрайтов кораблей

## Менеджеры системы

### ConfigManager
- Загрузка всех JSON конфигураций
- Типобезопасный доступ к настройкам
- Поддержка горячей замены систем

### MovementManager  
- Кинематическая система без физического движка
- Профиль скорости с плавным разгоном/торможением
- Учёт поворотной инерции и штрафов за манёвры

### CombatManager
- Спавн и управление NPC/врагами
- Автоматическая стрельба с упреждением
- Система здоровья и визуальные эффекты
- ИИ поведение (агрессивное, торговое)

### CameraManager
- Режимы слежения и свободной камеры
- Масштабирование с сохранением центра
- Плавные переходы между режимами

### InputManager
- Обработка мыши и клавиатуры
- Drag-to-pan панорамирование
- Разделение левого/правого кликов

### MinimapManager
- Отображение всей системы в миниатюре
- Реальное время: планеты, корабль, POI
- Индикатор области видимости камеры

### SaveManager
- Сохранение позиции и состояния корабля
- Автоматическое восстановление при запуске
- LocalStorage для браузерного сохранения

## Влияние параметров на геймплей

### Движение
- **MAX_SPEED**: влияет на время перелётов между объектами
- **ACCELERATION/DECELERATION**: определяет отзывчивость управления
- **TURN_SPEED**: манёвренность корабля в поворотах
- **SLOWING_RADIUS**: дистанция начала торможения перед целью

### Боевая система
- **Точность корабля**: влияет на эффективность упреждающей стрельбы
- **Скорость снарядов**: определяет сложность уклонения
- **Дальность оружия**: тактические возможности в бою
- **Скорострельность**: DPS и расход боеприпасов

### Системы
- **Размер системы**: время на исследование и перелёты
- **Количество планет**: плотность контента и торговых маршрутов
- **Скорость орбит**: динамичность окружения
- **Количество энкаунтеров**: частота событий

## Последовательность загрузки
1. **BootScene**: инициализация Phaser, подключение плагинов
2. **PreloadScene**: загрузка ассетов с прогресс-баром (rexUI)
3. **StarSystemScene**: основная игровая сцена
4. **UIScene**: интерфейс (миникарта, HUD) - запускается параллельно

## Реализованные возможности
- ✅ Кинематическое движение без физики
- ✅ Боевая система с ИИ
- ✅ Множественные звёздные системы
- ✅ Процедурная генерация
- ✅ NPC торговцы с автономным поведением
- ✅ Миникарта с реальным временем
- ✅ Система сохранений
- ✅ Конфигурационная архитектура
- ✅ Визуальные эффекты и анимации

## Планируемые улучшения
- 🔄 Туман войны и система видимости
- 🔄 Продвинутый A* планировщик маршрутов
- 🔄 Торговая система и экономика
- 🔄 Улучшения кораблей и модификации
- 🔄 Интеграция с LLM для нарративного контента


